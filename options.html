<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>评论洞察 - 配置</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .loading { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .custom-endpoint { display: none; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto max-w-4xl py-8 px-4">
        <!-- 头部 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">评论洞察 - 配置</h1>
                    <p class="text-gray-600 mt-2">配置API密钥和分析参数</p>
                </div>
                <div class="flex space-x-2">
                    <button id="import-btn" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                        导入配置
                    </button>
                    <button id="export-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        导出配置
                    </button>
                    <button id="save-btn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        保存配置
                    </button>
                </div>
            </div>
        </div>

        <!-- AI配置 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="bg-blue-100 text-blue-600 p-2 rounded-full mr-3">🤖</span>
                AI分析配置
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">API端点</label>
                    <select id="ai-endpoint-select" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="https://api.openai.com/v1">OpenAI (api.openai.com)</option>
                        <option value="https://openrouter.ai/api/v1">OpenRouter (openrouter.ai)</option>
                        <option value="https://api.siliconflow.cn/v1">SiliconFlow (api.siliconflow.cn)</option>
                        <option value="https://open.bigmodel.cn/api/paas/v4">ChatGLM (open.bigmodel.cn)</option>
                        <option value="https://api.deepseek.com/v1">DeepSeek (api.deepseek.com)</option>
                        <option value="https://api.moonshot.cn/v1">Kimi (api.moonshot.cn)</option>
                        <option value="custom">自定义端点</option>
                    </select>
                    <input type="url" id="ai-endpoint-custom" placeholder="https://your-api-endpoint.com/v1" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 mt-2 custom-endpoint"
                           style="display: none;">
                    <p class="text-xs text-gray-500 mt-1">选择或输入支持OpenAI兼容API的端点</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">API密钥</label>
                    <input type="password" id="ai-api-key" placeholder="sk-..." 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <p class="text-xs text-gray-500 mt-1">请确保密钥安全</p>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">模型选择</label>
                    <div class="flex space-x-2">
                        <select id="ai-model" class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">请先配置API密钥</option>
                        </select>
                        <button id="refresh-models" class="px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-lg">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">温度值</label>
                    <input type="range" id="ai-temperature" min="0" max="2" step="0.1" value="0.7" 
                           class="w-full">
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>保守 (0)</span>
                        <span id="temperature-value" class="font-medium">0.7</span>
                        <span>创新 (2)</span>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">最大令牌数</label>
                    <input type="number" id="ai-max-tokens" value="2000" min="100" max="100000" 
                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        分析提示词模板
                        <span class="text-xs text-gray-500 ml-2">使用 {comments} 作为评论内容占位符</span>
                    </label>
                    <textarea id="ai-analysis-template" rows="8" 
                              class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 font-mono text-sm"
                              placeholder="请分析以下社交媒体评论...">请分析以下社交媒体评论，生成结构化的分析报告。评论后面的 [👍 数字] 表示该评论的点赞数，缩进的"↳ 回复:"表示这是对上方评论的回复。点赞数高的评论代表更多用户的共鸣，请结合视频的主题和内容，特别关注这些热门评论和评论-回复之间的互动关系：

{comments}

请按照以下格式输出：

## 关键洞察
[结合视频主题，总结3-5个主要洞察点，特别关注高点赞评论反映的用户关注点]

## 情感分析
- 正面情感: X%
- 中性情感: X%
- 负面情感: X%

## 主要主题
1. [主题1]: [描述，标注是否为热门话题]
2. [主题2]: [描述，标注是否为热门话题]
3. [主题3]: [描述，标注是否为热门话题]

## 热门评论分析
[分析点赞数最高的评论，揭示用户最关心的内容]

## 显著趋势
[描述观察到的趋势和模式]

## 建议
[结合视频内容和评论反馈，提供可执行的建议]</textarea>
                </div>
            </div>

            <div class="mt-4 p-4 bg-blue-50 rounded-lg">
                <button id="test-ai-btn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                    <span class="test-text">测试AI连接</span>
                    <span class="test-loading hidden">
                        <svg class="inline w-4 h-4 loading mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                        测试中...
                    </span>
                </button>
                <span id="ai-test-result" class="ml-4 text-sm"></span>
            </div>
        </div>

        <!-- 平台配置 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="bg-green-100 text-green-600 p-2 rounded-full mr-3">🌐</span>
                平台配置
            </h2>
            
            <div class="space-y-6">
                <!-- 公共配置 -->
                <div class="border-l-4 border-purple-500 pl-4">
                    <h3 class="font-semibold text-lg flex items-center">
                        <span class="mr-2">⚙️</span> 公共配置
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">最大评论数</label>
                            <input type="number" id="platform-max-comments" value="100" min="10" max="1000" 
                                   class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">导出内容设置</label>
                            <div class="space-y-2">
                                <div class="flex items-center">
                                    <input type="checkbox" id="export-include-comments" class="mr-2">
                                    <span class="text-sm">包含评论详情</span>
                                </div>
                                <div class="flex items-center">
                                    <input type="checkbox" id="export-include-thinking" class="mr-2">
                                    <span class="text-sm">包含AI思考过程</span>
                                </div>
                            </div>
                        </div>
                        <div id="export-comments-sort-container" class="hidden">
                            <label class="block text-sm font-medium text-gray-700 mb-1">评论排序方式</label>
                            <select id="export-comments-sort" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-purple-500 focus:border-purple-500">
                                <option value="timestamp-desc">时间倒序</option>
                                <option value="timestamp-asc">时间正序</option>
                                <option value="likes-desc">点赞数降序</option>
                                <option value="likes-asc">点赞数升序</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- YouTube -->
                <div class="border-l-4 border-red-500 pl-4">
                    <h3 class="font-semibold text-lg flex items-center">
                        <span class="mr-2">📺</span> YouTube
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API密钥</label>
                            <input type="password" id="youtube-api-key" placeholder="YouTube Data API v3密钥" 
                                   class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-red-500 focus:border-red-500">
                        </div>
                    </div>
                </div>

                <!-- TikTok -->
                <div class="border-l-4 border-black pl-4">
                    <h3 class="font-semibold text-lg flex items-center">
                        <span class="mr-2">🎵</span> TikTok
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">提取模式</label>
                            <select id="tiktok-mode" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-black focus:border-black" disabled>
                                <option value="dom">DOM</option>
                            </select>
                            <p class="text-sm text-gray-500 mt-1">TikTok仅支持DOM解析模式</p>
                        </div>
                    </div>
                </div>

                <!-- Twitter/X -->
                <div class="border-l-4 border-blue-400 pl-4">
                    <h3 class="font-semibold text-lg flex items-center">
                        <span class="mr-2">🐦</span> Twitter/X
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">提取模式</label>
                            <select id="twitter-mode" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
                                <option value="dom">DOM</option>
                                <option value="api">API</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Bearer Token</label>
                            <input type="password" id="twitter-bearer-token" placeholder="Twitter API v2 Bearer Token" 
                                   class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">API版本</label>
                            <select id="twitter-api-version" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-400 focus:border-blue-400">
                                <option value="v2">v2 (推荐)</option>
                                <option value="v1.1">v1.1</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Bilibili -->
                <div class="border-l-4 border-pink-400 pl-4">
                    <h3 class="font-semibold text-lg flex items-center">
                        <span class="mr-2">📺</span> Bilibili
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-3">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">提取模式</label>
                            <select id="bilibili-mode" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-pink-400 focus:border-pink-400" disabled>
                                <option value="dom">DOM</option>
                            </select>
                            <p class="text-sm text-gray-500 mt-1">Bilibili仅支持DOM解析模式</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 状态栏 -->
        <div id="status-bar" class="fixed bottom-4 right-4 bg-white shadow-lg rounded-lg p-4 max-w-sm hidden">
            <div class="flex items-center space-x-2">
                <div id="status-icon" class="w-4 h-4 rounded-full"></div>
                <span id="status-text" class="text-sm"></span>
            </div>
        </div>
    </div>

    <!-- 隐藏的文件输入 -->
    <input type="file" id="import-file" accept=".json" style="display: none;">

    <script src="src/utils/default-config.js"></script>
    <script src="options.js"></script>
</body>
</html>